<html>
	<head>
		<title>Jimmy's Alt Tag Automator</title>
		<script
			  src="https://code.jquery.com/jquery-3.6.0.js"
			  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
			  crossorigin="anonymous">
			</script>
	</head>
	<body>

		<h1>Jimmy's Tag Automator</h1>
		<div style = "display:flex;">
			<input type="file" id = "html_browser" onchange="openHTML()" value = "Select HTML">
			<input type="file" id = "indd_browser" onchange="previewFile()" value = "Select INDD">
			<p>Preview:</p>
			<iframe id = "preview" height = "640" width = "480"></iframe>
			<p>Copy new code:</p>
			<textarea id = "copy_box" style = "height:200px;width:480px;"></textarea>
			<button onclick = "rl()">AUTOTAG</button>

		</div>

		<script>
		var file_text = "";
		var html_text = "";
		var alt_tags = ["one","two","three", "four","five"];
		var item_names = [];
		var prices = []; //maybe pull prices and other info from item lists xls?
		var item_count = 0;
			//open file
			function previewFile() {
			  const [file] = document.getElementById("indd_browser").files;
			  const reader = new FileReader();

			  reader.addEventListener("load", () => {
			    // this will then display a text file
			    file_text = reader.result;
					alert(file_text);
			  }, false);

			  if (file) {
			    reader.readAsText(file);
			  }
			}

			function openHTML() {
			  const [file] = document.getElementById("html_browser").files;
			  const reader = new FileReader();

			  reader.addEventListener("load", () => {
			    // this will then display a text file
			    html_text = reader.result;
					dummyElement.contentWindow.document.write(html_text);
			  }, false);

			  if (file) {
			    reader.readAsText(file);
			  }
			}

			var dummyElement = document.getElementById("preview");

			function rl() {
				dummyElement.src = "";
				var new_code = "";
				var images = [];
				var tagIndex = 0;

				//these are all images
				var elements = dummyElement.contentWindow.document.getElementsByTagName("img");

				for (var i = 0;i < elements.length;++i) {
					try {
						//check if item image
						if (elements[i].width == "320" || elements[i].width == "640") {
							elements[i].setAttribute("alt", alt_tags[tagIndex]);
							var path = elements[i].src.toString().split("/");
							var item_name = path[path.length-1].replace(".png","").replace("_"," ");
							item_names.push(item_name);
							++tagIndex;
							++item_count;
						}
					}

					catch {console.log("incorrect number of tags")}
				}

				//write changes to iframe
				document.getElementById("copy_box").value = dummyElement.contentWindow.document.body.innerHTML;
			}
		</script>

	</body>
</html>
