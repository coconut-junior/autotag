<html>
	<head>
		<title>Jimmy's Alt Tag Automator</title>
		<script
			  src="https://code.jquery.com/jquery-3.6.0.js"
			  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
			  crossorigin="anonymous">
			</script>
	</head>
	<body>

		<div style = "display:flex;">
			<p>Enter code here:</p>
			<textarea id = "code_box" style = "height:200px;width:480px;"></textarea>
			<input type="file" onchange="previewFile()" />
			<p>Preview:</p>
			<iframe id = "preview" height = "640" width = "480"></iframe>
			<p>Copy new code:</p>
			<textarea id = "copy_box" style = "height:200px;width:480px;"></textarea>
			<button onclick = "rl()">AUTOTAG</button>

		</div>

		<script>
		var text, parser, xmlDoc;
			//open file
			function previewFile() {
			  const content = document.querySelector('.content');
			  const [file] = document.querySelector('input[type=file]').files;
			  const reader = new FileReader();

			  reader.addEventListener("load", () => {
			    // this will then display a text file
			    text = reader.result;
					alert(text);
			  }, false);

			  if (file) {
			    reader.readAsText(file);
			  }
			}

			var dummyElement = document.getElementById("preview");

			function rl() {
				dummyElement.src = "";
				var new_code = "";
				var alt_tags = ["Ollie's Bargain Outlet!","two","three", "four"];
				var images = [];
				var codeBox = document.getElementById("code_box");
				var tagIndex = 0;

				//these are our images
				var elements = dummyElement.contentWindow.document.getElementsByTagName("img");

				for (var i = 0;i < elements.length;++i) {
					try {
						//check if item image
						if (elements[i].width == "320" || elements[i].width == "640") {
							elements[i].setAttribute("alt", alt_tags[tagIndex]);
							console.log(alt_tags[i]);
							++tagIndex;
						}
					}

					catch {console.log("incorrect number of tags")}
				}

				console.log("reloading...");

				//write changes to iframe
				dummyElement.contentWindow.document.write(document.getElementById("code_box").value);
				document.getElementById("copy_box").value = dummyElement.contentWindow.document.body.innerHTML;
			}
		</script>

	</body>
</html>
